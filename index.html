<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
<title>Monitoring Keuangan Minimalis</title>
<style>
  /* Reset and base */
  * {
    box-sizing: border-box;
  }
  body {
    margin: 0;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: #f5f7fa;
    color: #333;
    height: 100vh;
    max-height: 600px;
    overflow: hidden;
    display: flex;
    flex-direction: column;
  }
  /* Container */
  #app {
    flex: 1 1 auto;
    display: flex;
    flex-direction: column;
    padding: 12px 16px 60px 16px;
    max-height: 600px;
  }

  /* Navigation */
  nav {
    height: 48px;
    background: #fff;
    display: flex;
    box-shadow: 0 2px 8px rgb(0 0 0 / 0.1);
    border-radius: 8px;
    margin-bottom: 10px;
    overflow: hidden;
  }
  nav button {
    flex: 1 1 0;
    background: transparent;
    border: none;
    font-weight: 600;
    font-size: 14px;
    cursor: pointer;
    color: #555;
    transition: background-color 0.25s ease, color 0.25s ease;
    display: flex;
    align-items: center;
    justify-content: center;
    position: relative;
    user-select: none;
  }
  nav button.active,
  nav button:hover {
    background: #007bff;
    color: #fff;
  }
  nav button.active::after {
    content: "";
    position: absolute;
    bottom: 0;
    left: 30%;
    width: 40%;
    height: 3px;
    background: #0046b8;
    border-radius: 2px 2px 0 0;
  }

  /* Dashboard */
  .dashboard-filters {
    display: flex;
    justify-content: center;
    margin-bottom: 16px;
    gap: 12px;
  }
  .dashboard-filters button {
    background: #e1e9f8;
    border: none;
    padding: 10px 18px;
    border-radius: 24px;
    font-weight: 600;
    font-size: 13px;
    cursor: pointer;
    color: #4a90e2;
    box-shadow: 0 3px 6px rgb(0 0 0 / 0.1);
    transition: background-color 0.3s ease, color 0.3s ease;
    min-width: 80px;
  }
  .dashboard-filters button.active,
  .dashboard-filters button:hover {
    background: #007bff;
    color: white;
    box-shadow: 0 6px 12px rgb(0 123 255 / 0.6);
  }

  .totals {
    display: flex;
    justify-content: space-around;
    margin-bottom: 20px;
  }
  .total-box {
    background: white;
    border-radius: 14px;
    padding: 12px 20px;
    box-shadow: 0 3px 12px rgb(0 0 0 / 0.06);
    flex: 1 1 0;
    margin: 0 6px;
    text-align: center;
  }
  .total-box h2 {
    margin: 0 0 6px 0;
    font-weight: 700;
    font-size: 16px;
    color: #444;
  }
  .total-box p {
    margin: 0;
    font-weight: 700;
    font-size: 22px;
    color: #007bff;
  }
  .total-box.expense p {
    color: #e55353;
  }

  /* Chart container */
  #chart-container {
    background: white;
    border-radius: 14px;
    padding: 12px 16px 18px 16px;
    box-shadow: 0 2px 14px rgb(0 0 0 / 0.08);
  }
  canvas {
    width: 100% !important;
    height: 200px !important;
  }

  /* Transactions form */
  #transactions {
    background: white;
    border-radius: 14px;
    padding: 16px 20px 24px 20px;
    box-shadow: 0 3px 12px rgb(0 0 0 / 0.06);
    max-height: calc(100% - 48px);
    overflow-y: auto;
  }

  .form-group {
    margin-bottom: 16px;
  }
  label {
    display: block;
    font-weight: 600;
    font-size: 13px;
    margin-bottom: 6px;
    color: #333;
  }
  input[type="text"],
  input[type="number"],
  input[type="date"],
  select {
    width: 100%;
    padding: 10px 12px;
    font-size: 14px;
    border: 1.8px solid #dde3f0;
    border-radius: 8px;
    transition: border-color 0.25s ease;
  }
  input[type="text"]:focus,
  input[type="number"]:focus,
  input[type="date"]:focus,
  select:focus {
    border-color: #007bff;
    outline: none;
  }

  .transaction-type {
    display: flex;
    gap: 16px;
    margin-bottom: 20px;
  }
  .transaction-type label {
    flex: 1 1 50%;
    padding: 10px;
    cursor: pointer;
    border-radius: 24px;
    border: 1.8px solid #dde3f0;
    text-align: center;
    font-weight: 700;
    user-select: none;
    transition: background-color 0.3s ease, border-color 0.3s ease;
    color: #4a90e2;
  }
  .transaction-type input[type="radio"] {
    display: none;
  }
  .transaction-type input[type="radio"]:checked + label {
    background: #007bff;
    border-color: #0046b8;
    color: white;
    box-shadow: 0 6px 12px rgb(0 123 255 / 0.4);
  }

  .btn-submit {
    width: 100%;
    background: #007bff;
    color: white;
    border: none;
    border-radius: 24px;
    font-weight: 700;
    font-size: 15px;
    padding: 12px 0;
    cursor: pointer;
    box-shadow: 0 6px 12px rgb(0 123 255 / 0.4);
    transition: background-color 0.3s ease;
  }
  .btn-submit:hover {
    background: #0046b8;
  }

  /* History */
  #history {
    background: white;
    border-radius: 14px;
    padding: 14px 16px 14px 16px;
    box-shadow: 0 3px 20px rgb(0 0 0 / 0.07);
    max-height: calc(100% - 48px);
    overflow-y: auto;
    display: flex;
    flex-direction: column;
  }
  .history-filters {
    display: flex;
    gap: 12px;
    margin-bottom: 12px;
    flex-wrap: wrap;
  }
  .history-filters label {
    font-size: 13px;
    font-weight: 600;
    color: #333;
    margin-bottom: 4px;
  }
  .history-filters > div {
    flex: 1 1 45%;
  }
  .history-filters input[type="date"],
  .history-filters select {
    width: 100%;
    padding: 8px 10px;
    border-radius: 8px;
    border: 1.8px solid #dde3f0;
    font-size: 14px;
    transition: border-color 0.25s ease;
  }
  .history-filters input[type="date"]:focus,
  .history-filters select:focus {
    border-color: #007bff;
    outline: none;
  }
  .btn-filter {
    background: #007bff;
    color: white;
    border: none;
    padding: 10px 14px;
    border-radius: 20px;
    font-size: 13px;
    font-weight: 700;
    cursor: pointer;
    align-self: flex-start;
    box-shadow: 0 6px 12px rgb(0 123 255 / 0.4);
    transition: background-color 0.3s ease;
  }
  .btn-filter:hover {
    background: #0046b8;
  }

  .history-list {
    flex: 1 1 auto;
    overflow-y: auto;
    border-top: 1px solid #dde3f0;
    padding-top: 8px;
  }
  .transaction-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 10px 8px;
    border-bottom: 1px solid #eee;
  }
  .transaction-item:last-child {
    border-bottom: none;
  }
  .transaction-desc {
    font-weight: 600;
    font-size: 14px;
    color: #222;
    flex: 1 1 60%;
    overflow-wrap: break-word;
  }
  .transaction-amount {
    font-weight: 700;
    font-size: 15px;
    min-width: 90px;
    text-align: right;
  }
  .transaction-amount.income {
    color: #209924;
  }
  .transaction-amount.expense {
    color: #e55353;
  }
  .transaction-date {
    font-size: 11px;
    color: #777;
    margin-left: 12px;
    min-width: 72px;
    text-align: right;
  }

  /* Responsive for small devices */
  @media (max-width: 400px) {
    .history-filters > div {
      flex: 1 1 100%;
    }
    nav {
      font-size: 13px;
    }
    .transaction-desc {
      font-size: 13px;
    }
  }

  /* Footer */
  footer {
    flex-shrink: 0;
    background: #007bff;
    color: white;
    text-align: center;
    padding: 8px 0;
    font-size: 13px;
    font-weight: 600;
    user-select: none;
  }
  footer a {
    color: #d1e9ff;
    text-decoration: none;
    transition: color 0.3s ease;
  }
  footer a:hover,
  footer a:focus {
    color: white;
    text-decoration: underline;
  }
</style>
</head>
<body>
<div id="app">
  <nav>
    <button id="nav-dashboard" class="active" aria-controls="dashboard">Dashboard</button>
    <button id="nav-transactions" aria-controls="transactions">Transaksi</button>
    <button id="nav-history" aria-controls="history">History</button>
  </nav>

  <section id="dashboard" role="tabpanel">
    <div class="dashboard-filters" role="group" aria-label="Filter dashboard">
      <button data-filter="day" class="active">Hari</button>
      <button data-filter="week">Minggu</button>
      <button data-filter="month">Bulan</button>
    </div>
    <div class="totals">
      <div class="total-box income">
        <h2>Pemasukan</h2>
        <p id="total-income">Rp 0</p>
      </div>
      <div class="total-box expense">
        <h2>Pengeluaran</h2>
        <p id="total-expense">Rp 0</p>
      </div>
    </div>
    <div id="chart-container">
      <canvas id="financeChart" aria-label="Grafik pemasukan dan pengeluaran" role="img"></canvas>
    </div>
  </section>

  <section id="transactions" role="tabpanel" hidden>
    <form id="transactionForm" aria-label="Form input transaksi" autocomplete="off">
      <div class="transaction-type" role="radiogroup" aria-labelledby="transaction-type-label">
        <input type="radio" name="type" id="type-income" value="income" checked />
        <label for="type-income">Masuk</label>
        <input type="radio" name="type" id="type-expense" value="expense" />
        <label for="type-expense">Keluar</label>
      </div>

      <div class="form-group">
        <label for="desc">Keterangan</label>
        <input type="text" id="desc" name="desc" placeholder="Misal: Gaji, belanja..." required maxlength="50" autocomplete="off" />
      </div>

      <div class="form-group">
        <label for="amount">Jumlah (Rp)</label>
        <input type="text" id="amount" name="amount" placeholder="0" required inputmode="numeric" autocomplete="off" />
      </div>

      <div class="form-group">
        <label for="date">Tanggal</label>
        <input type="date" id="date" name="date" required />
      </div>

      <button type="submit" class="btn-submit">Tambah Transaksi</button>
    </form>
  </section>

  <section id="history" role="tabpanel" hidden>
    <div class="history-filters">
      <div>
        <label for="filter-date">Filter Tanggal</label>
        <input type="date" id="filter-date" />
      </div>
      <div>
        <label for="filter-month">Filter Bulan</label>
        <input type="month" id="filter-month" />
      </div>
      <button class="btn-filter" id="btn-filter-history">Terapkan Filter</button>
      <button class="btn-filter" style="background:#6c757d; margin-left: 6px;" id="btn-clear-filter">Clear</button>
    </div>
    <div class="history-list" tabindex="0" aria-live="polite" aria-relevant="additions removals">
      <!-- Transaction items will appear here -->
    </div>
  </section>
</div>
<footer>
  <a href="https://alfajrin23.github.io/personal_portofolio/" target="_blank" rel="noopener noreferrer">&copy; 2024 by Al Fajrin A A</a>
</footer>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
(() => {
  // Application state
  let transactions = [];
  const STORAGE_KEY = "financeMonitoringTransactions";

  // DOM references
  const navDashboard = document.getElementById('nav-dashboard');
  const navTransactions = document.getElementById('nav-transactions');
  const navHistory = document.getElementById('nav-history');
  const sections = {
    dashboard: document.getElementById('dashboard'),
    transactions: document.getElementById('transactions'),
    history: document.getElementById('history')
  };

  // Dashboard elements
  const filterButtons = document.querySelectorAll('.dashboard-filters button');
  const totalIncomeElem = document.getElementById('total-income');
  const totalExpenseElem = document.getElementById('total-expense');

  // Transactions elements
  const transactionForm = document.getElementById('transactionForm');
  const inputDate = document.getElementById('date');
  const inputAmount = document.getElementById('amount');

  // History filters
  const filterDateInput = document.getElementById('filter-date');
  const filterMonthInput = document.getElementById('filter-month');
  const btnApplyFilter = document.getElementById('btn-filter-history');
  const btnClearFilter = document.getElementById('btn-clear-filter');
  const historyList = document.querySelector('.history-list');

  // Chart
  let financeChart = null;

  // Utility functions
  function formatRupiah(number) {
    if (number == null || isNaN(number)) return 'Rp 0';
    return 'Rp ' + number.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ".");
  }

  function parseNumberFromRupiah(rupiahStr) {
    // Remove dots and non digit characters and parse to number
    return parseInt(rupiahStr.replace(/\./g, '').replace(/[^\d]/g, '')) || 0;
  }

  function parseDate(input) {
    // input is yyyy-mm-dd string
    const parts = input.split("-");
    return new Date(parts[0], parts[1] - 1, parts[2]);
  }

  function formatDate(input) {
    // input is Date object
    // Format dd/mm/yyyy
    let d = input.getDate().toString().padStart(2, "0");
    let m = (input.getMonth() + 1).toString().padStart(2, "0");
    let y = input.getFullYear();
    return `${d}/${m}/${y}`;
  }

  function isoDate(date) {
    // return yyyy-mm-dd string
    const y = date.getFullYear();
    const m = (date.getMonth() + 1).toString().padStart(2, '0');
    const d = date.getDate().toString().padStart(2, '0');
    return `${y}-${m}-${d}`;
  }

  function loadTransactions() {
    const loaded = localStorage.getItem(STORAGE_KEY);
    transactions = loaded ? JSON.parse(loaded) : [];
  }
  function saveTransactions() {
    localStorage.setItem(STORAGE_KEY, JSON.stringify(transactions));
  }

  // Navigation
  function switchSection(target) {
    Object.entries(sections).forEach(([key, section]) => {
      if(key === target) {
        section.hidden = false;
        section.setAttribute('aria-hidden', 'false');
      } else {
        section.hidden = true;
        section.setAttribute('aria-hidden', 'true');
      }
    });
    [navDashboard, navTransactions, navHistory].forEach(btn => {
      btn.classList.toggle('active', btn.id === 'nav-' + target);
    });
    if (target === 'dashboard') {
      updateDashboard();
    } else if (target === 'history') {
      renderHistoryList();
    }
  }
  navDashboard.addEventListener('click', () => switchSection('dashboard'));
  navTransactions.addEventListener('click', () => switchSection('transactions'));
  navHistory.addEventListener('click', () => switchSection('history'));

  // Dashboard filters selection
  let dashboardFilter = 'day';
  filterButtons.forEach(btn => {
    btn.addEventListener('click', () => {
      filterButtons.forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
      dashboardFilter = btn.dataset.filter;
      updateDashboard();
    });
  });

  // Update totals and chart on dashboard according to filter
  function updateDashboard() {
    const now = new Date();
    let filteredTransactions = transactions.filter(tx => {
      const txDate = new Date(tx.date);
      if(dashboardFilter === 'day') {
        // same day
        return txDate.toDateString() === now.toDateString();
      } else if(dashboardFilter === 'week') {
        // same week number (ISO week)
        return getWeekNumber(txDate) === getWeekNumber(now) && txDate.getFullYear() === now.getFullYear();
      } else if(dashboardFilter === 'month') {
        return txDate.getMonth() === now.getMonth() && txDate.getFullYear() === now.getFullYear();
      }
      return true;
    });

    // Calculate totals
    let totalIncome = 0;
    let totalExpense = 0;
    filteredTransactions.forEach(tx => {
      if(tx.type === 'income') totalIncome += tx.amount;
      else totalExpense += tx.amount;
    });

    totalIncomeElem.textContent = formatRupiah(totalIncome);
    totalExpenseElem.textContent = formatRupiah(totalExpense);

    // Prepare chart data for the selected period (daily or weekly or monthly)
    let labels = [];
    let incomeData = [];
    let expenseData = [];
    if(dashboardFilter === 'day') {
      // Label: hours 0-23
      labels = Array.from({length: 24}, (_, i) => `${i}:00`);
      incomeData = Array(24).fill(0);
      expenseData = Array(24).fill(0);
      filteredTransactions.forEach(tx => {
        const h = new Date(tx.date).getHours();
        if(tx.type === 'income') incomeData[h] += tx.amount;
        else expenseData[h] += tx.amount;
      });
    } else if(dashboardFilter === 'week') {
      // Label days Mon-Sun
      labels = ['Sen', 'Sel', 'Rab', 'Kam', 'Jum', 'Sab', 'Min'];
      incomeData = Array(7).fill(0);
      expenseData = Array(7).fill(0);
      filteredTransactions.forEach(tx => {
        let d = new Date(tx.date).getDay();
        // JS getDay: Sun=0... Sat=6, so shift Sun(0)=>6; Mon(1)=>0...
        d = d === 0 ? 6 : d - 1;
        if(tx.type === 'income') incomeData[d] += tx.amount;
        else expenseData[d] += tx.amount;
      });
    } else if(dashboardFilter === 'month') {
      // Label days of month
      const daysInMonth = new Date(now.getFullYear(), now.getMonth()+1, 0).getDate();
      labels = Array.from({length: daysInMonth}, (_, i) => (i+1).toString());
      incomeData = Array(daysInMonth).fill(0);
      expenseData = Array(daysInMonth).fill(0);
      filteredTransactions.forEach(tx => {
        const date = new Date(tx.date).getDate() - 1;
        if(tx.type === 'income') incomeData[date] += tx.amount;
        else expenseData[date] += tx.amount;
      });
    }

    updateChart(labels, incomeData, expenseData);
  }

  function updateChart(labels, incomeData, expenseData) {
    if(financeChart) {
      financeChart.data.labels = labels;
      financeChart.data.datasets[0].data = incomeData;
      financeChart.data.datasets[1].data = expenseData;
      financeChart.update();
    } else {
      const ctx = document.getElementById('financeChart').getContext('2d');
      financeChart = new Chart(ctx, {
        type: 'bar',
        data: {
          labels: labels,
          datasets: [
            {
              label: 'Pemasukan',
              backgroundColor: '#4caf50cc',
              borderColor: '#4caf50',
              borderWidth: 1,
              data: incomeData,
            },
            {
              label: 'Pengeluaran',
              backgroundColor: '#e55353cc',
              borderColor: '#e55353',
              borderWidth: 1,
              data: expenseData,
            }
          ]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          scales: {
            y: {
              beginAtZero: true,
              ticks: {
                callback: function(value) {
                  return value >= 1000 ? (value/1000) + 'k' : value;
                }
              }
            }
          },
          plugins: {
            legend: {
              labels: {
                font: {
                  size: 13,
                }
              }
            },
          }
        }
      });
    }
  }

  function getWeekNumber(d) {
    // Copy date so don't modify original
    d = new Date(Date.UTC(d.getFullYear(), d.getMonth(), d.getDate()));
    // Set to nearest Thursday: current date + 4 - current day number
    // 0=Sunday, 1=Monday, ...
    d.setUTCDate(d.getUTCDate() + 4 - (d.getUTCDay()||7));
    // Get first day of year
    const yearStart = new Date(Date.UTC(d.getUTCFullYear(), 0, 1));
    // Calculate full weeks to nearest Thursday
    const weekNo = Math.ceil(((d - yearStart) / 86400000 + 1)/7);
    return weekNo;
  }

  // Transaction form submit
  transactionForm.addEventListener('submit', function(event) {
    event.preventDefault();
    const type = transactionForm.type.value;
    const desc = transactionForm.desc.value.trim();
    const amountVal = parseNumberFromRupiah(inputAmount.value);
    const dateVal = transactionForm.date.value;

    if(!desc || amountVal <= 0 || !dateVal) {
      alert("Mohon isi semua data dengan benar.");
      return;
    }

    const newTx = {
      id: Date.now(),
      type: type,
      description: desc,
      amount: amountVal,
      date: dateVal + "T00:00:00"
    };
    transactions.push(newTx);
    saveTransactions();
    transactionForm.reset();
    setDefaultDate();
    inputAmount.value = ''; // clear formatted field
    alert("Transaksi berhasil ditambahkan!");
    updateDashboard();

    // Automatically switch to History so user can see
    switchSection('history');
  });

  // Init default date in transaction input
  function setDefaultDate() {
    inputDate.value = isoDate(new Date());
  }

  // Render history list with optional filter
  function renderHistoryList(filter={}) {
    // filter may have date or month (yyyy-mm or full yyyy-mm-dd)
    let filtered = transactions;

    if(filter.date) {
      filtered = filtered.filter(tx => tx.date.startsWith(filter.date));
    } else if(filter.month) {
      filtered = filtered.filter(tx => tx.date.startsWith(filter.month));
    }

    // Sort descending date newest first
    filtered.sort((a,b) => new Date(b.date) - new Date(a.date));

    if(filtered.length === 0) {
      historyList.innerHTML = '<p style="text-align:center; color:#999; margin-top: 20px;">Tidak ada transaksi ditemukan.</p>';
      return;
    }

    const fragment = document.createDocumentFragment();
    filtered.forEach(tx => {
      const item = document.createElement('div');
      item.className = 'transaction-item';
      // Description
      const desc = document.createElement('div');
      desc.className = 'transaction-desc';
      desc.textContent = tx.description;
      // Amount
      const amount = document.createElement('div');
      amount.className = 'transaction-amount ' + (tx.type === 'income' ? 'income' : 'expense');
      amount.textContent = formatRupiah(tx.amount);
      // Date
      const dateDisp = document.createElement('div');
      dateDisp.className = 'transaction-date';
      dateDisp.textContent = formatDate(new Date(tx.date));

      item.appendChild(desc);
      item.appendChild(amount);
      item.appendChild(dateDisp);
      fragment.appendChild(item);
    });
    historyList.innerHTML = '';
    historyList.appendChild(fragment);
  }

  btnApplyFilter.addEventListener('click', () => {
    const dateVal = filterDateInput.value;
    const monthVal = filterMonthInput.value;
    if(dateVal) {
      renderHistoryList({date: dateVal});
    } else if(monthVal) {
      renderHistoryList({month: monthVal});
    } else {
      renderHistoryList();
    }
  });

  btnClearFilter.addEventListener('click', () => {
    filterDateInput.value = '';
    filterMonthInput.value = '';
    renderHistoryList();
  });

  // Amount input thousand separator formatting
  inputAmount.addEventListener('input', (e) => {
    let cursorPosition = inputAmount.selectionStart;
    let originalLength = inputAmount.value.length;

    // Remove all non-digit and non-comma (,) characters (comma optional if user tries to input)
    let value = inputAmount.value.replace(/[^0-9]/g, '');

    if(value === '') {
      inputAmount.value = '';
      return;
    }
    // Format number with thousand separators '.'
    let formatted = '';
    let count = 0;
    for(let i = value.length -1; i >=0; i--) {
      formatted = value[i] + formatted;
      count++;
      if(count === 3 && i !== 0) {
        formatted = '.' + formatted;
        count = 0;
      }
    }
    inputAmount.value = formatted;

    // Adjust cursor position after formatting
    let newLength = inputAmount.value.length;
    cursorPosition = cursorPosition + (newLength - originalLength);
    inputAmount.setSelectionRange(cursorPosition, cursorPosition);
  });


  // Initialize
  function init() {
    loadTransactions();
    setDefaultDate();
    updateDashboard();
    renderHistoryList();
  }

  init();
})();
</script>
</body>
</html>

